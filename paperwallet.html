<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Bitcoin & Counterparty Paper Wallet</title>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.css">
    <script src="jss/mnemonic.js"></script>
    <script src="jss/bitcore/bitcore.min.js"></script>
    <script type="text/javascript" src="jss/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="jss/qrcode.min.js"></script>
    <script type="text/javascript" src="jss/bitcoinjs.min.js"></script>
    <style>
        img.menu_links {
            cursor: pointer;
        }
		#myTablePassphrase {
			font-family: "Courier New", Courier, monospace; 
			font-size: 19px;
			font-weight: bold;
		}
    </style>
</head>
<body>

    <div class="container" style="width: 670px; margin-left: auto; margin-right: auto;">
        <div class="row">
            <br />
            <div class="col-sm-7">
                <h4 style="margin-left:0px">
                    Bitcoin & Counterparty Paper Wallet
                    <br /><small>Using a 12 Word Passphrase</small>
                </h4>
            </div>
            <div class="col-sm-5">
                <div class=" pull-right" style="text-align: right">
                        <img id="Img1" src="images/btc_xcp.png" alt="Logo" style="margin-top: -0px;  margin-top: 5px" width="140" />
                </div>
            </div>
        </div>

        <hr  />
        <div class="col-sm-12">
            <div class="alert alert-info" role="alert" style="margin-left:-15px;margin-right:-15px">The passphrase can be used in Counterwallet, XCP Chrome Wallet and GetGems Messenger.</div>
        </div>
        <div id="login">
            

            <form class="form-horizontal">
                <div class="form-group">
                    <label for="input1" class="col-sm-2 control-label">Passphrase</label>
                    <div class="col-sm-10">
                        <input class="form-control" id="input1" placeholder=" Enter your 12 word counterwallet passphrase" style="width: 100%;" title=" Enter your 12 word counterwallet passphrase here" >
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Address Count</label>
                    <div class="col-sm-10">
                        <input class="form-control" id="num_of_address" placeholder=" Number of address(es) to generate" value="3" title="Enter the number of addresses/keys you wish to generate" style="width: 50px;" maxlength="2" >
                    </div>
                </div>
                <div class="form-group form-inline">
                    <label class="col-sm-2 control-label">Options</label>
                    <div class="col-sm-10">
                        <div class="checkbox ">
                            <label>
                                <input type="checkbox" id="showkeys" checked value="2">
                                Show Corresponding Private Keys
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        &nbsp; <span id="spinwheel" style="display: none "> <img src="images/ajax-loader.gif" sizes="1" /> </span>
                    </div>
                    <center>
                        <button type="button" class="btn btn-default" onclick="myFunction2();">Generate Paper Wallet</button>
                    </center>
                </div>                
            </form>
        </div>      

        <div id="addresstable">		
            <div class="row">               
				<table id="myTablePassphrase" class="table table-striped">
					<tr><td id="pp1"  style="width:16.7%"></td><td id="pp2" style="width:16.7%"></td><td id="pp3" style="width:16.7%"></td><td id="pp4" style="width:16.6%"></td><td id="pp5"  style="width:16.7%"></td><td id="pp6" style="width:16.6%"></td></tr>
					<tr><td id="pp7"></td><td id="pp8"></td><td id="pp9"></td><td id="pp10"></td><td id="pp11"></td><td id="pp12"></td></tr>
				</table>
                <table id="myTable" class="table table-striped"></table>                                                 
            </div> 
            <center>
                <button type="button" class="btn btn-default" onclick="location.reload()">Forget & Make New</button>    
            </center>
        </div>



        <script type="text/javascript">

            $("#addresstable").hide();

            var bitcore = require('bitcore');

            function myFunction() {
                var $btn = $("#spinwheel");
                $btn.show();
                setTimeout(function () {
                    m = new Mnemonic(128);
                    m.toWords();
                    
                    var str = m.toWords().toString();
                    var res = str.replace(/,/gi, " ");
                    var phraseList = res;
                    $('#input1').val(phraseList);
                    var HDPrivateKey = bitcore.HDPrivateKey.fromSeed(m.toHex(), bitcore.Networks.livenet);
                    var derived = HDPrivateKey.derive("m/0'/0/" + "0");
                    var address1 = new bitcore.Address(derived.publicKey, bitcore.Networks.livenet);
                    $("#spinwheel").hide();
                }, 200);
            }

            function myFunction2() {

                var isValid = false;
                var string = $('#input1').val().trim().toLowerCase();
                string = string.replace(/\s{2,}/g, ' ');
                var array = string.split(" ");

                var listOfWordsArray = Mnemonic.words.toString().split(',');

                listOfWordsArray = listOfWordsArray.toString();
                for (var i = 0; i < array.length; i++) {
                    if (listOfWordsArray.indexOf(array[i]) > -1) {
                        //
                    } else {
                        isValid = true;
                    }
                }

                var x = $('#num_of_address').val();

                if (array.length != 12) {
                    alert('Incorrect Passphrase used (It should be exactly 12 words. No more, no less)');
                    $("#input1").focus();
                } else if (isValid == true) {
                    alert('Invalid Passphrase entered');
                    $("#input1").focus();
                } else if (isNaN(x)) {
                    alert("Must input numbers");
                    $('#num_of_address').focus();
                    return false;
                } else {
                    if (x < 1 || x > 99) {
                        $('#num_of_address').val(1);
                    }
                    var $btn = $("#spinwheel");
                    $btn.show();
                    setTimeout(function () {

                        var blnshowaddress = true;
                        var blnshowkeys = $('#showkeys').prop('checked');

                        m2 = new Mnemonic(array);

                        var HDPrivateKey = bitcore.HDPrivateKey.fromSeed(m2.toHex(), bitcore.Networks.livenet);
                        var intcountaddr = $('#num_of_address').val();
						
						//$('#myTablePassphrase').text("ASD");
						$('#pp1').text(array[0]);
						$('#pp2').text(array[1]);
						$('#pp3').text(array[2]);
						$('#pp4').text(array[3]);
						$('#pp5').text(array[4]);
						$('#pp6').text(array[5]);
						$('#pp7').text(array[6]);
						$('#pp8').text(array[7]);
						$('#pp9').text(array[8]);
						$('#pp10').text(array[9]);
						$('#pp11').text(array[10]);
						$('#pp12').text(array[11]);
						

                        var table = document.getElementById("myTable");
                        table.innerHTML = "";
                        var row = table.insertRow(0);
                        var cell0 = row.insertCell(0);
                        var cell1 = row.insertCell(1);
                        //var cell2 = row.insertCell(2);

                        var derivedArray = [];
                        for (var i = 0; i < intcountaddr; i++) {
                            var derived = HDPrivateKey.derive("m/0'/0/" + i);
                            var address1 = new bitcore.Address(derived.publicKey, bitcore.Networks.livenet);
                            var row = table.insertRow(i + 1);

                            var cell0 = row.insertCell(0);
                            cell0.innerHTML = "[QR for Address #" + (i+1) + "]";

                            var cell1 = row.insertCell(1);
                            if (blnshowaddress == true) {
                                cell1.innerHTML = "Address #" + (i+1) + ":<br /><span style=\"font-family: 'Courier New', Courier, monospace; font-size:18px; font-weight: bold;\">" + address1.toString().replace(/(.{4})/g,'$1 ') + "</span>";
                            } else { cell1.innerHTML = "..."; }
							if (blnshowkeys == true) {
                                cell1.innerHTML += "<br /><br />Secret Private Key;<br /><span style=\"font-family: 'Courier New', Courier, monospace; font-size:18px; font-weight: bold;\">" + derived.privateKey.toWIF().replace(/(.{4})/g,'$1 ') + "</span>";
                            } else {  }
                            //var cell2 = row.insertCell(2);
                            //cell2.innerHTML = "[QR for Private Key #" + (i + 1) + "]";
                        }
                        $("#spinwheel").hide();
                    }, 500);
                    $("#login").hide();
                    $("#addresstable").show();
                }
            }

            myFunction();

            function makecode(strcode) {
                document.getElementById("qrcode").innerHTML = '';
                var qrcode = new QRCode("qrcode", {
                    text: strcode,
                    width: 190,
                    height: 190,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            }


            function signmessage() {

                var strmsgtosign = $('#messagetosign').val();
                var strwifkey = $('#signprivatekey').val();

                var key = bitcoin.ECKey.fromWIF(strwifkey)
                var message = strmsgtosign;
                var signature = bitcoin.Message.sign(key, message);
                $('#signedmessage').val(signature.toString('base64'));
                alert('Message Signed')

            }

            $('#myModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget)
                var recipient = button.data('whatever')
                var modal = $(this)
                modal.find('.modal-title').text("QRcode for BTC Address " + recipient + "")
                makecode(recipient);
            })

            $('#myModal2').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget)
                var strAddress = button.data('address')
                var strPrivKey = button.data('privatekey')
                var modal = $(this)
                modal.find('.modal-title2').text("Sign Message for " + strAddress + "")                
                $('#signaddress').val(strAddress);
                $('#signprivatekey').val(strPrivKey);
                $('#messagetosign').val('');
                $('#signedmessage').val('');                                
            })
            

        </script>

    </div>
    <hr style="width: 830px; margin-left: auto; margin-right: auto;" />
    <footer class="footer">
        <div class="container">
            <p align="center">No warranty provided | <a href="https://github.com/blockscan/cw_address_key_generator" target="_blank">GitHub Repository</a></p>
        </div>
    </footer>

    <script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>

</body>
</html>
